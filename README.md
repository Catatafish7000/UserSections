Инициализация базы данных и создание необходимых таблиц:

docker-compose up  

goose -dir migrations postgres "host=127.0.0.1 port=5432  user=kirill password=avito sslmode=disable dbname=db" up

Для тестирования я накидал несколько url-ов в файл avitoDev.postman_collection.json, его нужно импортировать в Postman.


Доступные запросы:

/new/{название_секции}/{доля_пользователей(%)} - создать новую секцию с заданным процентом пользователей, которым она будет назначаться. Метод PUT

/delete/{название_секции} - удаление выбранной секции, что также удалит относящиеся к ней назначения и историю о них. Метод DELETE

/add/{id_пользователя}/{ttl(в днях)} - автоматическое назначение юзеру с данным номером секций в соответствии с заданной в секции долей на заданное в ttl количество дней. Проверка на истечение ttl производится в кроне раз в 12 часов. Метод PUT

/remove/{id_пользователя}/{название_секции}- удаление соответствующего назначения сегмента пользователю и запись информации об этом в историю. Метод PUT

/show/{id_пользователя} - вывод всех назначенных данному юзеру секций в формате JSON. Метод GET

/history/{год}/{месяц} - вывод истории изменения назначений в заданный период в формате JSON.

id_пользователя, доля_пользователей, ttl, год и месяц в данных урлах должны быть числами, иначе будет сообщение об ошибке.